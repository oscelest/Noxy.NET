@inherits ElementComponent

<div @attributes="AdditionalAttributes" class="@CssClass">
    <TemplateSchemaOverview Schema="Schema" List="Schema.ContextList">
        <Header>
            <h3>Action steps</h3>
        </Header>

        <Form>
            @if (context != null)
            {
                <SidebarRightLayout>
                    <Sidebar>
                        <FormSchemaContext Schema="Schema" Value="context" OnChange="FormChange"/>
                    </Sidebar>
                    <Content>
                        <JunctionFormSchemaContextHasAction Entity="context" Available="Schema.ActionList"/>
                        <JunctionFormSchemaContextHasElement Entity="context" Available="Schema.ElementList"/>
                    </Content>
                </SidebarRightLayout>
            }
            else
            {
                <FormSchemaContext Schema="Schema" OnChange="FormChange"/>
            }
        </Form>

        <Display>
            <TemplateInputGroup DisplayName="@TextConstants.FormEntitySchemaLabelSchemaIdentifier">
                <span>@context.SchemaIdentifier.DefaultIfEmpty(TextConstants.DefaultEmptyValue)</span>
            </TemplateInputGroup>

            <TemplateInputGroup DisplayName="@TextConstants.FormEntitySchemaLabelName">
                <span>@context.Name.DefaultIfEmpty(TextConstants.DefaultEmptyValue)</span>
            </TemplateInputGroup>

            <TemplateInputGroup DisplayName="@TextConstants.FormEntitySchemaLabelNote">
                <span>@context.Note.DefaultIfEmpty(TextConstants.DefaultEmptyValue)</span>
            </TemplateInputGroup>

            <TemplateInputGroup DisplayName="@TextConstants.FormEntitySchemaLabelTitle">
                <span>@context.Title.DefaultIfEmpty(TextConstants.DefaultEmptyValue)</span>
            </TemplateInputGroup>

            <TemplateInputGroup DisplayName="@TextConstants.FormEntitySchemaLabelDescription">
                <span>@context.Description.DefaultIfEmpty(TextConstants.DefaultEmptyValue)</span>
            </TemplateInputGroup>
        </Display>
    </TemplateSchemaOverview>
</div>

@code {

    [Parameter, EditorRequired]
    public required EntitySchema Schema { get; set; }

    private void FormChange(EntitySchemaContext entity)
    {
        Schema.ContextList = Schema.ContextList?.Where(x => x.ID != entity.ID).Append(entity).OrderBy(x => x.Order).ToList();
    }

}